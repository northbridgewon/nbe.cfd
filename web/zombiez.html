<html><head><base href="https://websim.ai/"><title>ZombieFest - Top Down RPG Shooter</title><style>
body, html {
    margin: 0;
    padding: 0;
    height: 100%;
    font-family: 'Press Start 2P', cursive;
    background-color: #1a1a1a;
    color: #00ff00;
    overflow: hidden;
}
#game-container {
    width: 100%;
    height: 100%;
    position: relative;
}
#game-canvas {
    width: 100%;
    height: 100%;
    display: block;
}
#hud {
    position: absolute;
    top: 1vh;
    left: 1vw;
    font-size: 1.4vh;
    background-color: rgba(0,0,0,0.7);
    padding: 1vh;
    border-radius: 0.5vh;
    border: 0.2vh solid #00ff00;
}
#menu-container {
    display: none;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: rgba(0,0,0,0.8);
    padding: 2vh;
    border: 0.2vh solid #00ff00;
    width: 30vw;
    max-width: 400px;
    border-radius: 1vh;
}
.tab-buttons {
    display: flex;
    justify-content: space-around;
    margin-bottom: 2vh;
}
.tab-button {
    background-color: #333;
    color: #00ff00;
    border: none;
    padding: 1vh 2vw;
    cursor: pointer;
    font-family: 'Press Start 2P', cursive;
    font-size: 1.2vh;
    border-radius: 0.5vh;
}
.tab-button.active {
    background-color: #00ff00;
    color: #333;
}
.tab-content {
    display: none;
}
.tab-content.active {
    display: block;
}
.menu-item {
    margin: 1vh 0;
    cursor: pointer;
    transition: color 0.3s ease;
    font-size: 1.2vh;
}
.menu-item:hover {
    color: #ff0000;
}
.menu-item.sold-out {
    color: #888;
    cursor: not-allowed;
}
.menu-item.highlight {
    color: #ffff00;
}
.shop-section {
    margin-bottom: 2vh;
}
.shop-section-title {
    color: #ff9900;
    font-size: 1.6vh;
    margin-bottom: 1vh;
}
#controls {
    position: absolute;
    bottom: 1vh;
    left: 1vw;
    font-size: 1.2vh;
    background-color: rgba(0,0,0,0.7);
    padding: 1vh;
    border-radius: 0.5vh;
    border: 0.2vh solid #00ff00;
}
#game-over {
    display: none;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: rgba(0,0,0,0.8);
    padding: 2vh;
    border: 0.2vh solid #ff0000;
    text-align: center;
    border-radius: 1vh;
    font-size: 1.4vh;
}
#wave-announcement {
    display: none;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 3.6vh;
    color: #ff0000;
    text-shadow: 0.2vh 0.2vh #000000;
}
#title-screen {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.9);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}
#title-screen h1 {
    font-size: 5vh;
    color: #ff0000;
    text-shadow: 0.3vh 0.3vh #00ff00;
    margin-bottom: 3vh;
}
#name-input {
    font-size: 1.8vh;
    padding: 1vh;
    width: 30vw;
    max-width: 300px;
    margin-bottom: 2vh;
    background-color: #333;
    color: #00ff00;
    border: 0.2vh solid #00ff00;
    font-family: 'Press Start 2P', cursive;
}
#start-game {
    font-size: 2.4vh;
    padding: 1.5vh 3vw;
    background-color: #00ff00;
    color: #000;
    border: none;
    cursor: pointer;
    font-family: 'Press Start 2P', cursive;
}
#credits {
    position: absolute;
    bottom: 1vh;
    right: 1vw;
    font-size: 1.2vh;
    color: #888;
}
</style>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head><body>
<div id="game-container">
    <canvas id="game-canvas"></canvas>
    <div id="hud">
        Health: <span id="health">100</span>/<span id="max-health">100</span> | XP: <span id="xp">0</span> | Level: <span id="level">1</span><br>
        Weapon: <span id="weapon">Pistol (Lv.1)</span> | Wave: <span id="wave">1</span>
    </div>
    <div id="menu-container">
        <div class="tab-buttons">
            <button class="tab-button active" onclick="openTab('menu')">Menu</button>
            <button class="tab-button" onclick="openTab('shop')">Shop</button>
            <button class="tab-button" onclick="openTab('inventory')">Inventory</button>
        </div>
        <div id="menu" class="tab-content active">
            <h2><span id="player-name">Terry Loot</span></h2>
            <p>Level: <span id="menu-level">1</span></p>
            <p>Health: <span id="menu-health">100</span>/<span id="menu-max-health">100</span></p>
            <p>Weapon: <span id="menu-weapon">Pistol (Lv.1)</span></p>
            <p>XP: <span id="menu-xp">0</span></p>
            <div class="menu-item" onclick="resumeGame()">Resume Game</div>
        </div>
        <div id="shop" class="tab-content">
            <h2>Shop</h2>
            <div class="shop-section">
                <div class="shop-section-title">Weapons</div>
                <div id="shotgun-buy" class="menu-item" onclick="buyWeapon('Shotgun', 200)">Buy Shotgun (200 XP)</div>
                <div id="smg-buy" class="menu-item" onclick="buyWeapon('SMG', 500)">Buy SMG (500 XP)</div>
                <div id="sniper-buy" class="menu-item" onclick="buyWeapon('Sniper', 1000)">Buy Sniper (1000 XP)</div>
                <div id="minigun-buy" class="menu-item" onclick="buyWeapon('Minigun', 2000)">Buy Minigun (2000 XP)</div>
            </div>
            <div class="shop-section">
                <div class="shop-section-title">Upgrades</div>
                <div class="menu-item" id="upgrade-weapon" onclick="upgradeWeapon()">Upgrade Weapon (100 XP)</div>
                <div class="menu-item" id="upgrade-speed" onclick="upgradeSpeed()">Upgrade Speed (150 XP)</div>
            </div>
            <div class="shop-section">
                <div class="shop-section-title">Healing</div>
                <div class="menu-item" id="heal-character" onclick="healCharacter()">Heal (50 XP)</div>
            </div>
        </div>
        <div id="inventory" class="tab-content">
            <h2>Inventory</h2>
            <p>Level: <span id="inventory-level">1</span></p>
            <div id="inventory-weapons"></div>
        </div>
    </div>
    <div id="controls">
        Controls: WASD - Move | Mouse - Aim | Hold Left Click - Shoot | TAB - Menu/Shop | SHIFT - Slow Movement
    </div>
    <div id="game-over">
        <h2>Game Over!</h2>
        <p>You reached wave <span id="final-wave"></span></p>
        <div class="menu-item" onclick="restartGame()">Play Again</div>
    </div>
    <div id="wave-announcement"></div>
    <div id="title-screen">
        <h1>ZombieFest</h1>
        <input type="text" id="name-input" placeholder="Enter your name" value="Terry Loot">
        <button id="start-game" onclick="startGame()">Start Game</button>
    </div>
    <div id="credits">
        AI Directed By: StickGuy<br>
        Programmed By: AI
    </div>
</div>

<script>
const canvas = document.getElementById('game-canvas');
const ctx = canvas.getContext('2d');
const player = {
    name: "Terry Loot",
    x: 400,
    y: 300,
    baseSpeed: 5,
    currentSpeed: 5,
    slowSpeed: 2.5,
    health: 100,
    maxHealth: 100,
    xp: 0,
    level: 1,
    weapon: { name: "Pistol", level: 1, damage: 10, fireRate: 1, bulletCount: 1, spread: 0 },
    movementX: 0,
    movementY: 0,
    damageEffect: 0,
    deathAnimation: null,
    acceleration: 0.5,
    deceleration: 0.8,
    maxSpeed: 7,
    velocity: { x: 0, y: 0 }
};
let zombies = [];
let bullets = [];
let zombieBullets = [];
let gameLoop;
let menuOpen = false;
let gameActive = false;
let gamePaused = false;
let keys = {};
let lastShot = 0;
let mouseX = 0;
let mouseY = 0;
let isShooting = false;
let currentWave = 1;
let zombiesInWave = 5;
let zombiesSpawned = 0;
let zombiesKilled = 0;
let isSlowMovement = false;
let upgradeWeaponCost = 100;
let upgradeSpeedCost = 150;
let healCost = 50;
let upgradeWeaponCount = 0;
let upgradeSpeedCount = 0;
let healCount = 0;
let inventory = {
    Pistol: { level: 1, damage: 10, fireRate: 1, bulletCount: 1, spread: 0 }
};
let deathAnimations = [];

// Audio context for 8-bit sound effects and background music
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
let backgroundMusic;

function loadBackgroundMusic() {
    const request = new XMLHttpRequest();
    request.open('GET', 'https://example.com/phonk_music.mp3', true);
    request.responseType = 'arraybuffer';

    request.onload = function() {
        audioCtx.decodeAudioData(request.response, function(buffer) {
            backgroundMusic = buffer;
            playBackgroundMusic();
        });
    }
    request.send();
}

function playBackgroundMusic() {
    const source = audioCtx.createBufferSource();
    source.buffer = backgroundMusic;
    source.connect(audioCtx.destination);
    source.loop = true;
    source.start();
}

function createOscillator(freq, type, duration) {
    const oscillator = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();
    
    oscillator.type = type;
    oscillator.frequency.setValueAtTime(freq, audioCtx.currentTime);
    
    gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
    
    oscillator.connect(gainNode);
    gainNode.connect(audioCtx.destination);
    
    oscillator.start();
    oscillator.stop(audioCtx.currentTime + duration);
}

function playShootSound() {
    createOscillator(200, 'square', 0.1);
}

function playMenuSound() {
    createOscillator(440, 'sine', 0.1);
}

function playDeathSound() {
    createOscillator(100, 'sawtooth', 0.3);
}

function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}

window.addEventListener('resize', resizeCanvas);
resizeCanvas();

function startGame() {
    const nameInput = document.getElementById('name-input');
    player.name = nameInput.value || "Terry Loot";
    document.getElementById('title-screen').style.display = 'none';
    gameActive = true;
    updateHUD();
    announceWave();
    loadBackgroundMusic();
}

function drawPlayer() {
    if (player.deathAnimation) {
        drawDeathAnimation(player.deathAnimation);
    } else {
        ctx.fillStyle = player.damageEffect > 0 ? `rgba(255,0,0,${player.damageEffect})` : '#00ff00';
        ctx.beginPath();
        ctx.arc(player.x, player.y, 20, 0, Math.PI * 2);
        ctx.fill();
        
        if (player.damageEffect > 0) {
            player.damageEffect -= 0.05;
        }
    }
}

function drawZombies() {
    zombies.forEach(zombie => {
        if (zombie.deathAnimation) {
            drawDeathAnimation(zombie.deathAnimation);
        } else {
            let baseColor;
            switch(zombie.type) {
                case 'normal':
                    baseColor = [255, 0, 0];
                    break;
                case 'fast':
                    baseColor = [255, 136, 0];
                    break;
                case 'big':
                    baseColor = [136, 0, 0];
                    break;
                case 'shooter':
                    baseColor = [255, 0, 255];
                    break;
            }
            
            let damageColor = zombie.damageEffect > 0 ? [255, 255, 255] : baseColor;
            let blendedColor = baseColor.map((channel, index) => 
                Math.floor(channel * (1 - zombie.damageEffect) + damageColor[index] * zombie.damageEffect)
            );
            
            ctx.fillStyle = `rgb(${blendedColor.join(',')})`;
            ctx.beginPath();
            ctx.arc(zombie.x, zombie.y, zombie.type === 'big' ? 25 : 15, 0, Math.PI * 2);
            ctx.fill();
            
            if (zombie.damageEffect > 0) {
                zombie.damageEffect -= 0.1;
            }
        }
    });
}

function drawDeathAnimation(animation) {
    ctx.beginPath();
    ctx.arc(animation.x, animation.y, animation.radius, 0, Math.PI * 2);
    ctx.fillStyle = `rgba(${animation.color.join(',')},${animation.opacity})`;
    ctx.fill();
}

function updateDeathAnimations() {
    deathAnimations = deathAnimations.filter(animation => {
        animation.radius += 2;
        animation.opacity -= 0.05;
        drawDeathAnimation(animation);
        return animation.opacity > 0;
    });
}

function drawBullets() {
    ctx.fillStyle = '#ffff00';
    bullets.forEach(bullet => {
        ctx.beginPath();
        ctx.arc(bullet.x, bullet.y, 5, 0, Math.PI * 2);
        ctx.fill();
    });
    
    ctx.fillStyle = '#ff00ff';
    zombieBullets.forEach(bullet => {
        ctx.beginPath();
        ctx.arc(bullet.x, bullet.y, 3, 0, Math.PI * 2);
        ctx.fill();
    });
}

function updateGame() {
    if (!gameActive || gamePaused) return;

    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    if (zombiesSpawned < zombiesInWave && Math.random() < 0.02 + (currentWave * 0.005)) {
        spawnZombie();
        zombiesSpawned++;
    }
    
    updatePlayerMovement();
    moveZombies();
    moveBullets();
    checkCollisions();
    
    if (isShooting) {
        shoot();
    }
    
    zombies.forEach(zombie => {
        if (zombie.type === 'shooter' && Math.random() < 0.01) {
            zombieShoot(zombie);
        }
    });
    
    drawPlayer();
    drawZombies();
    drawBullets();
    updateDeathAnimations();

    if (zombiesKilled >= zombiesInWave) {
        startNewWave();
    }
}

function updatePlayerMovement() {
    if (player.deathAnimation) return;

    let acceleration = player.acceleration;
    if (isSlowMovement) {
        acceleration *= 0.5;
    }

    if (keys['w']) player.velocity.y -= acceleration;
    if (keys['s']) player.velocity.y += acceleration;
    if (keys['a']) player.velocity.x -= acceleration;
    if (keys['d']) player.velocity.x += acceleration;

    // Apply deceleration
    player.velocity.x *= player.deceleration;
    player.velocity.y *= player.deceleration;

    // Limit max speed
    let speed = Math.sqrt(player.velocity.x * player.velocity.x + player.velocity.y * player.velocity.y);
    if (speed > player.maxSpeed) {
        let ratio = player.maxSpeed / speed;
        player.velocity.x *= ratio;
        player.velocity.y *= ratio;
    }

    // Update position
    player.x += player.velocity.x;
    player.y += player.velocity.y;

    // Keep player within canvas bounds
    player.x = Math.max(20, Math.min(canvas.width - 20, player.x));
    player.y = Math.max(20, Math.min(canvas.height - 20, player.y));
}

function spawnZombie() {
    const side = Math.floor(Math.random() * 4);
    let x, y;
    switch(side) {
        case 0: x = 0; y = Math.random() * canvas.height; break;
        case 1: x = canvas.width; y = Math.random() * canvas.height; break;
        case 2: x = Math.random() * canvas.width; y = 0; break;
        case 3: x = Math.random() * canvas.width; y = canvas.height; break;
    }
    
    const zombieType = Math.random();
    let zombie;
    
    if (zombieType < 0.6) {
        zombie = { 
            x, y, 
            health: 20 + (currentWave * 2),
            speed: 1 + (currentWave * 0.1),
            type: 'normal',
            damageEffect: 0
        };
    } else if (zombieType < 0.8) {
        zombie = { 
            x, y, 
            health: 15 + (currentWave * 1.5),
            speed: 2 + (currentWave * 0.15),
            type: 'fast',
            damageEffect: 0
        };
    } else if (zombieType < 0.95) {
        zombie = { 
            x, y, 
            health: 40 + (currentWave * 4),
            speed: 0.5 + (currentWave * 0.05),
            type: 'big',
            damageEffect: 0
        };
    } else {
        zombie = { 
            x, y, 
            health: 25 + (currentWave * 2.5),
            speed: 0.8 + (currentWave * 0.08),
            type: 'shooter',
            lastShot: 0,
            damageEffect: 0
        };
    }
    
    zombies.push(zombie);
}

function moveZombies() {
    zombies.forEach(zombie => {
        if (!zombie.deathAnimation) {
            const angle = Math.atan2(player.y - zombie.y, player.x - zombie.x);
            zombie.x += Math.cos(angle) * zombie.speed;
            zombie.y += Math.sin(angle) * zombie.speed;
        }
    });
}

function moveBullets() {
    bullets.forEach(bullet => {
        bullet.x += bullet.dx * 10;
        bullet.y += bullet.dy * 10;
    });
    bullets = bullets.filter(bullet => 
        bullet.x > 0 && bullet.x < canvas.width && 
        bullet.y > 0 && bullet.y < canvas.height
    );
    
    zombieBullets.forEach(bullet => {
        bullet.x += bullet.dx * 5;
        bullet.y += bullet.dy * 5;
    });
    zombieBullets = zombieBullets.filter(bullet => 
        bullet.x > 0 && bullet.x < canvas.width && 
        bullet.y > 0 && bullet.y < canvas.height
    );
}

function checkCollisions() {
    zombies.forEach(zombie => {
        if (!zombie.deathAnimation && !player.deathAnimation && Math.hypot(zombie.x - player.x, zombie.y - player.y) < 35) {
            let damage = 1 + Math.floor(currentWave / 3);
            if (zombie.type === 'big') damage *= 2;
            player.health -= damage;
            player.damageEffect = 1;
            updateHUD();
            if (player.health <= 0) playerDeath();
        }
    });
    
    bullets = bullets.filter(bullet => {
        let bulletHit = false;
        zombies = zombies.filter(zombie => {
            if (!zombie.deathAnimation && Math.hypot(zombie.x - bullet.x, zombie.y - bullet.y) < 20) {
                zombie.health -= player.weapon.damage;
                zombie.damageEffect = 1;
                bulletHit = true;
                if (zombie.health <= 0) {
                    zombieDeath(zombie);
                    zombiesKilled++;
                    player.xp += 10 + currentWave;
                    if (player.xp >= player.level * 100) levelUp();
                    updateHUD();
                    return false;
                }
            }
            return true;
        });
        return !bulletHit;
    });
    
    zombieBullets = zombieBullets.filter(bullet => {
        if (!player.deathAnimation && Math.hypot(bullet.x - player.x, bullet.y - player.y) < 20) {
            player.health -= 5 + Math.floor(currentWave / 2);
            player.damageEffect = 1;
            updateHUD();
            if (player.health <= 0) playerDeath();
            return false;
        }
        return true;
    });
}

function playerDeath() {
    player.deathAnimation = {
        x: player.x,
        y: player.y,
        radius: 20,
        opacity: 1,
        color: [0, 255, 0]
    };
    deathAnimations.push(player.deathAnimation);
    playDeathSound();
    setTimeout(gameOver, 1000);
}

function zombieDeath(zombie) {
    let color;
    switch(zombie.type) {
        case 'normal': color = [255, 0, 0]; break;
        case 'fast': color = [255, 136, 0]; break;
        case 'big': color = [136, 0, 0]; break;
        case 'shooter': color = [255, 0, 255]; break;
    }
    zombie.deathAnimation = {
        x: zombie.x,
        y: zombie.y,
        radius: zombie.type === 'big' ? 25 : 15,
        opacity: 1,
        color: color
    };
    deathAnimations.push(zombie.deathAnimation);
    playDeathSound();
}

function shoot() {
    const now = Date.now();
    if (now - lastShot >= 1000 / player.weapon.fireRate) {
        const angle = Math.atan2(mouseY - player.y, mouseX - player.x);
        for (let i = 0; i < player.weapon.bulletCount; i++) {
            const spreadAngle = angle + (Math.random() - 0.5) * player.weapon.spread;
            bullets.push({
                x: player.x,
                y: player.y,
                dx: Math.cos(spreadAngle),
                dy: Math.sin(spreadAngle)
            });
        }
        playShootSound();
        lastShot = now;
    }
}

function zombieShoot(zombie) {
    const now = Date.now();
    if (now - zombie.lastShot >= 2000) {
        const angle = Math.atan2(player.y - zombie.y, player.x - zombie.x);
        zombieBullets.push({
            x: zombie.x,
            y: zombie.y,
            dx: Math.cos(angle),
            dy: Math.sin(angle)
        });
        zombie.lastShot = now;
    }
}

function levelUp() {
    player.level++;
    player.maxHealth = 100 + (player.level * 10);
    player.health = player.maxHealth;
    player.baseSpeed += 0.2;
    player.currentSpeed = isSlowMovement ? player.slowSpeed : player.baseSpeed;
    updateHUD();
    playMenuSound();
}

function gameOver() {
    gameActive = false;
    document.getElementById('game-over').style.display = 'block';
    document.getElementById('final-wave').textContent = currentWave;
    playDeathSound();
}

function updateHUD() {
    document.getElementById('health').textContent = player.health;
    document.getElementById('max-health').textContent = player.maxHealth;
    document.getElementById('xp').textContent = player.xp;
    document.getElementById('level').textContent = player.level;
    document.getElementById('weapon').textContent = `${player.weapon.name} (Lv.${player.weapon.level})`;
    document.getElementById('wave').textContent = currentWave;
    
    document.getElementById('player-name').textContent = player.name;
    document.getElementById('menu-level').textContent = player.level;
    document.getElementById('menu-health').textContent = player.health;
    document.getElementById('menu-max-health').textContent = player.maxHealth;
    document.getElementById('menu-weapon').textContent = `${player.weapon.name} (Lv.${player.weapon.level})`;
    document.getElementById('menu-xp').textContent = player.xp;
    
    document.getElementById('upgrade-weapon').textContent = `Upgrade Weapon (${upgradeWeaponCost} XP)`;
    document.getElementById('upgrade-speed').textContent = `Upgrade Speed (${upgradeSpeedCost} XP)`;
    document.getElementById('heal-character').textContent = `Heal (${healCost} XP)`;
    
    document.getElementById('inventory-level').textContent = player.level;
    
    updateInventoryDisplay();
}

function buyWeapon(weaponName, cost) {
    if (player.xp >= cost && !inventory[weaponName]) {
        player.xp -= cost;
        switch(weaponName) {
            case 'Shotgun':
                inventory[weaponName] = { level: 1, damage: 15, fireRate: 1, bulletCount: 5, spread: 0.5 };
                break;
            case 'SMG':
                inventory[weaponName] = { level: 1, damage: 8, fireRate: 10, bulletCount: 1, spread: 0.2 };
                break;
            case 'Sniper':
                inventory[weaponName] = { level: 1, damage: 100, fireRate: 0.5, bulletCount: 1, spread: 0 };
                break;
            case 'Minigun':
                inventory[weaponName] = { level: 1, damage: 12, fireRate: 15, bulletCount: 1, spread: 0.3 };
                break;
        }
        selectWeapon(weaponName);
        updateHUD();
        playMenuSound();
        const element = document.getElementById(`${weaponName.toLowerCase()}-buy`);
        element.classList.add('sold-out');
        element.onclick = null;
        highlightMenuItem(element);
    }
}

function upgradeWeapon() {
    if (player.xp >= upgradeWeaponCost) {
        player.xp -= upgradeWeaponCost;
        player.weapon.level++;
        player.weapon.damage += 5 + Math.floor(player.level / 2);
        inventory[player.weapon.name].level = player.weapon.level;
        inventory[player.weapon.name].damage = player.weapon.damage;
        upgradeWeaponCount++;
        upgradeWeaponCost = Math.floor(100 * Math.pow(1.1, upgradeWeaponCount));
        updateHUD();
        playMenuSound();
        highlightMenuItem(document.getElementById('upgrade-weapon'));
    }
}

function upgradeSpeed() {
    if (player.xp >= upgradeSpeedCost) {
        player.xp -= upgradeSpeedCost;
        player.baseSpeed += 0.5;
        player.maxSpeed += 0.5;
        player.currentSpeed = isSlowMovement ? player.slowSpeed : player.baseSpeed;
        upgradeSpeedCount++;
        upgradeSpeedCost = Math.floor(150 * Math.pow(1.15, upgradeSpeedCount));
        updateHUD();
        playMenuSound();
        highlightMenuItem(document.getElementById('upgrade-speed'));
    }
}

function healCharacter() {
    if (player.xp >= healCost) {
        player.xp -= healCost;
        const healAmount = 20 + (player.level * 5);
        player.health = Math.min(player.health + healAmount, player.maxHealth);
        healCount++;
        healCost = Math.floor(50 * Math.pow(1.05, healCount));
        updateHUD();
        playMenuSound();
        highlightMenuItem(document.getElementById('heal-character'));
    }
}

function highlightMenuItem(element) {
    element.classList.add('highlight');
    setTimeout(() => {
        element.classList.remove('highlight');
    }, 1000);
}

function selectWeapon(weaponName) {
    if (inventory[weaponName]) {
        player.weapon = { name: weaponName, ...inventory[weaponName] };
        updateHUD();
        playMenuSound();
    }
}

function updateInventoryDisplay() {
    const inventoryDiv = document.getElementById('inventory-weapons');
    inventoryDiv.innerHTML = '';
    for (const [weaponName, weaponStats] of Object.entries(inventory)) {
        const weaponDiv = document.createElement('div');
        weaponDiv.className = 'menu-item';
        weaponDiv.textContent = `${weaponName} (Lv.${weaponStats.level})`;
        weaponDiv.onclick = () => selectWeapon(weaponName);
        inventoryDiv.appendChild(weaponDiv);
    }
}

function resumeGame() {
    document.getElementById('menu-container').style.display = 'none';
    menuOpen = false;
    gamePaused = false;
    playMenuSound();
}

function restartGame() {
    player.health = 100;
    player.maxHealth = 100;
    player.xp = 0;
    player.level = 1;
    player.weapon = { name: "Pistol", level: 1, damage: 10, fireRate: 1, bulletCount: 1, spread: 0 };
    player.baseSpeed = 5;
    player.currentSpeed = 5;
    player.slowSpeed = 2.5;
    player.damageEffect = 0;
    player.deathAnimation = null;
    player.x = canvas.width / 2;
    player.y = canvas.height / 2;
    player.velocity = { x: 0, y: 0 };
    player.maxSpeed = 7;
    zombies = [];
    bullets = [];
    zombieBullets = [];
    deathAnimations = [];
    currentWave = 1;
    zombiesInWave = 5;
    zombiesSpawned = 0;
    zombiesKilled = 0;
    gameActive = true;
    gamePaused = false;
    upgradeWeaponCost = 100;
    upgradeSpeedCost = 150;
    healCost = 50;
    upgradeWeaponCount = 0;
    upgradeSpeedCount = 0;
    healCount = 0;
    inventory = {
        Pistol: { level: 1, damage: 10, fireRate: 1, bulletCount: 1, spread: 0 }
    };
    document.getElementById('game-over').style.display = 'none';
    updateHUD();
    announceWave();
    resetShop();
    playMenuSound();
}

function resetShop() {
    const weapons = ['shotgun', 'smg', 'sniper', 'minigun'];
    weapons.forEach(weapon => {
        const element = document.getElementById(`${weapon}-buy`);
        element.classList.remove('sold-out');
        element.onclick = () => buyWeapon(weapon.charAt(0).toUpperCase() + weapon.slice(1), getWeaponCost(weapon));
    });
}

function getWeaponCost(weapon) {
    switch(weapon) {
        case 'shotgun': return 200;
        case 'smg': return 500;
        case 'sniper': return 1000;
        case 'minigun': return 2000;
        default: return 0;
    }
}

function startNewWave() {
    currentWave++;
    zombiesInWave = Math.floor(5 * Math.pow(1.2, currentWave));
    zombiesSpawned = 0;
    zombiesKilled = 0;
    updateHUD();
    announceWave();
}

function announceWave() {
    const announcement = document.getElementById('wave-announcement');
    announcement.textContent = `Wave ${currentWave}`;
    announcement.style.display = 'block';
    setTimeout(() => {
        announcement.style.display = 'none';
    }, 2000);
    playMenuSound();
}

function toggleMenu() {
    menuOpen = !menuOpen;
    gamePaused = menuOpen;
    document.getElementById('menu-container').style.display = menuOpen ? 'block' : 'none';
    if (menuOpen) updateHUD();
    playMenuSound();
}

function openTab(tabName) {
    const tabContents = document.getElementsByClassName('tab-content');
    for (let i = 0; i < tabContents.length; i++) {
        tabContents[i].classList.remove('active');
    }
    const tabButtons = document.getElementsByClassName('tab-button');
    for (let i = 0; i < tabButtons.length; i++) {
        tabButtons[i].classList.remove('active');
    }
    document.getElementById(tabName).classList.add('active');
    document.querySelector(`.tab-button[onclick="openTab('${tabName}')"]`).classList.add('active');
    playMenuSound();
}

document.addEventListener('keydown', (e) => {
    if (!gameActive) return;
    keys[e.key.toLowerCase()] = true;
    if (e.key === 'Shift') {
        isSlowMovement = true;
    }
    if (e.key === 'Tab') {
        e.preventDefault();
        toggleMenu();
    }
});

document.addEventListener('keyup', (e) => {
    keys[e.key.toLowerCase()] = false;
    if (e.key === 'Shift') {
        isSlowMovement = false;
    }
});

canvas.addEventListener('mousemove', (e) => {
    mouseX = e.clientX;
    mouseY = e.clientY;
});

canvas.addEventListener('mousedown', (e) => {
    if (e.button === 0 && !menuOpen && gameActive) {
        isShooting = true;
    }
});

canvas.addEventListener('mouseup', (e) => {
    if (e.button === 0) {
        isShooting = false;
    }
});

canvas.addEventListener('mouseleave', () => {
    isShooting = false;
});

gameLoop = setInterval(updateGame, 1000 / 60);
updateHUD();
</script></body></html>