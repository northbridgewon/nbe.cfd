<html><head><base href="https://websim.ai%20remove%20the%20text%20above,%20add%20the%20record%20options%20and%20add%20more%20keybinding%20letters"><title>WebSim Advanced Piano Studio</title>
<style>
  body {
    font-family: 'Roboto', sans-serif;
    background-color: #121212;
    color: #e0e0e0;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    padding: 20px;
    box-sizing: border-box;
  }
  .piano-container {
    background-color: #1e1e1e;
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    overflow-x: auto;
    max-width: 100%;
    margin-bottom: 20px;
  }
  .piano {
    display: flex;
    justify-content: flex-start;
    align-items: flex-start;
    height: 240px;
  }
  .key {
    width: 40px;
    height: 200px;
    background-color: #f0f0f0;
    border: 1px solid #333;
    margin-right: 2px;
    cursor: pointer;
    transition: all 0.1s ease;
    position: relative;
  }
  .key:last-child {
    margin-right: 0;
  }
  .key.black {
    width: 24px;
    height: 120px;
    background-color: #000;
    margin-left: -14px;
    margin-right: -14px;
    z-index: 2;
  }
  .key:active, .key.active {
    background-color: #b0b0b0;
    transform: translateY(2px);
  }
  .key.black:active, .key.black.active {
    background-color: #333;
  }
  .key-label {
    position: absolute;
    bottom: 5px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 12px;
    color: #333;
  }
  .key.black .key-label {
    color: #fff;
    bottom: 10px;
  }
  .controls {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
    margin-bottom: 20px;
  }
  .control-btn {
    background-color: #4CAF50;
    border: none;
    color: white;
    padding: 10px 20px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 4px 2px;
    cursor: pointer;
    border-radius: 5px;
    transition: background-color 0.3s;
  }
  .control-btn:hover {
    background-color: #45a049;
  }
  .control-btn.record {
    background-color: #f44336;
  }
  .control-btn.record:hover {
    background-color: #d32f2f;
  }
  .control-btn.play {
    background-color: #2196F3;
  }
  .control-btn.play:hover {
    background-color: #1976D2;
  }
  .keybindings {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 10px;
    width: 100%;
    max-width: 1000px;
    margin-bottom: 20px;
  }
  .keybinding-item {
    background-color: #2a2a2a;
    border: 1px solid #444;
    padding: 10px;
    border-radius: 5px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .keybinding-item input {
    background-color: #333;
    border: 1px solid #555;
    color: #fff;
    padding: 5px;
    border-radius: 3px;
    width: 30px;
    text-align: center;
  }
  .save-btn {
    background-color: #2196F3;
    margin-top: 20px;
  }
  .save-btn:hover {
    background-color: #1976D2;
  }
  .recording-list {
    width: 100%;
    max-width: 800px;
    margin-top: 20px;
  }
  .recording-item {
    background-color: #2a2a2a;
    border: 1px solid #444;
    padding: 10px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-radius: 5px;
  }
  .recording-item button {
    margin-left: 10px;
  }
</style>
</head>
<body>
<div class="piano-container">
  <div class="piano" id="piano"></div>
</div>
<div class="controls">
  <button class="control-btn" id="octave-down">Octave Down</button>
  <span id="octave-display">Octave: 4</span>
  <button class="control-btn" id="octave-up">Octave Up</button>
  <button class="control-btn record" id="record">Record</button>
  <button class="control-btn play" id="play">Play</button>
</div>
<div class="keybindings" id="keybindings"></div>
<button class="control-btn save-btn" id="save-keybindings">Save Keybindings</button>
<div class="recording-list" id="recording-list"></div>

<script>
const audioContext = new (window.AudioContext || window.webkitAudioContext)();
const pianoElement = document.getElementById('piano');
const octaveDownBtn = document.getElementById('octave-down');
const octaveUpBtn = document.getElementById('octave-up');
const octaveDisplay = document.getElementById('octave-display');
const keybindingsContainer = document.getElementById('keybindings');
const saveKeybindingsBtn = document.getElementById('save-keybindings');
const recordBtn = document.getElementById('record');
const playBtn = document.getElementById('play');
const recordingList = document.getElementById('recording-list');

let currentOctave = 4;
let isRecording = false;
let currentRecording = [];
let recordings = [];

const noteSequence = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
let keyboardMap = {
  'A': 'C', 'W': 'C#', 'S': 'D', 'E': 'D#', 'D': 'E', 'F': 'F',
  'T': 'F#', 'G': 'G', 'Y': 'G#', 'H': 'A', 'U': 'A#', 'J': 'B',
  'K': 'C', 'O': 'C#', 'L': 'D', 'P': 'D#', ';': 'E', "'": 'F',
  ']': 'F#', '\\': 'G', 'Z': 'G#', 'X': 'A', 'C': 'A#', 'V': 'B'
};

function createKey(note, octave, isBlack) {
  const key = document.createElement('div');
  key.className = `key${isBlack ? ' black' : ''}`;
  key.dataset.note = note;
  key.dataset.octave = octave;

  const label = document.createElement('span');
  label.className = 'key-label';
  label.textContent = `${note}${octave}`;
  key.appendChild(label);

  return key;
}

function renderPiano() {
  pianoElement.innerHTML = '';
  for (let i = 0; i < 3; i++) {
    noteSequence.forEach((note, index) => {
      const octave = currentOctave + i;
      const isBlack = note.includes('#');
      const key = createKey(note, octave, isBlack);
      pianoElement.appendChild(key);
    });
  }
}

function playNote(frequency) {
  const oscillator = audioContext.createOscillator();
  const gainNode = audioContext.createGain();
  
  oscillator.type = 'sine';
  oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
  
  gainNode.gain.setValueAtTime(0.7, audioContext.currentTime);
  gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 1);
  
  oscillator.connect(gainNode);
  gainNode.connect(audioContext.destination);
  
  oscillator.start();
  oscillator.stop(audioContext.currentTime + 1);

  if (isRecording) {
    currentRecording.push({
      frequency,
      time: Date.now()
    });
  }
}

function getNoteFrequency(note, octave) {
  const baseFrequency = 440; // A4
  const semitones = noteSequence.indexOf(note) - noteSequence.indexOf('A') + (octave - 4) * 12;
  return baseFrequency * Math.pow(2, semitones / 12);
}

function renderKeybindings() {
  keybindingsContainer.innerHTML = '';
  Object.entries(keyboardMap).forEach(([key, note]) => {
    const item = document.createElement('div');
    item.className = 'keybinding-item';
    item.innerHTML = `
      <span>${note}</span>
      <input type="text" maxlength="1" value="${key}">
    `;
    keybindingsContainer.appendChild(item);
  });
}

function renderRecordings() {
  recordingList.innerHTML = '';
  recordings.forEach((recording, index) => {
    const item = document.createElement('div');
    item.className = 'recording-item';
    item.innerHTML = `
      <span>Recording ${index + 1}</span>
      <div>
        <button class="control-btn play" onclick="playRecording(${index})">Play</button>
        <button class="control-btn" onclick="deleteRecording(${index})">Delete</button>
      </div>
    `;
    recordingList.appendChild(item);
  });
}

pianoElement.addEventListener('mousedown', (event) => {
  if (event.target.classList.contains('key')) {
    const note = event.target.dataset.note;
    const octave = parseInt(event.target.dataset.octave);
    playNote(getNoteFrequency(note, octave));
    event.target.classList.add('active');
  }
});

pianoElement.addEventListener('mouseup', (event) => {
  if (event.target.classList.contains('key')) {
    event.target.classList.remove('active');
  }
});

pianoElement.addEventListener('mouseleave', (event) => {
  if (event.target.classList.contains('key')) {
    event.target.classList.remove('active');
  }
});

document.addEventListener('keydown', (event) => {
  const key = event.key.toUpperCase();
  const note = keyboardMap[key];
  if (note) {
    const octave = currentOctave + (noteSequence.indexOf(note) >= noteSequence.indexOf('C') ? 0 : 1);
    playNote(getNoteFrequency(note, octave));
    const keyElement = document.querySelector(`.key[data-note="${note}"][data-octave="${octave}"]`);
    if (keyElement) keyElement.classList.add('active');
  }
});

document.addEventListener('keyup', (event) => {
  const key = event.key.toUpperCase();
  const note = keyboardMap[key];
  if (note) {
    const octave = currentOctave + (noteSequence.indexOf(note) >= noteSequence.indexOf('C') ? 0 : 1);
    const keyElement = document.querySelector(`.key[data-note="${note}"][data-octave="${octave}"]`);
    if (keyElement) keyElement.classList.remove('active');
  }
});

octaveDownBtn.addEventListener('click', () => {
  if (currentOctave > 0) {
    currentOctave--;
    renderPiano();
    updateOctaveDisplay();
  }
});

octaveUpBtn.addEventListener('click', () => {
  if (currentOctave < 6) {
    currentOctave++;
    renderPiano();
    updateOctaveDisplay();
  }
});

saveKeybindingsBtn.addEventListener('click', () => {
  const inputs = keybindingsContainer.querySelectorAll('input');
  const newKeyboardMap = {};
  inputs.forEach(input => {
    const note = input.parentElement.querySelector('span').textContent;
    const key = input.value.toUpperCase();
    if (key && !newKeyboardMap[key]) {
      newKeyboardMap[key] = note;
    }
  });
  keyboardMap = newKeyboardMap;
  renderKeybindings();
  alert('Keybindings saved successfully!');
});

recordBtn.addEventListener('click', () => {
  if (isRecording) {
    isRecording = false;
    recordBtn.textContent = 'Record';
    recordings.push(currentRecording);
    renderRecordings();
    currentRecording = [];
  } else {
    isRecording = true;
    recordBtn.textContent = 'Stop Recording';
  }
});

playBtn.addEventListener('click', () => {
  if (recordings.length > 0) {
    playRecording(recordings.length - 1);
  }
});

function playRecording(index) {
  const recording = recordings[index];
  const startTime = recording[0].time;
  recording.forEach((note) => {
    setTimeout(() => {
      playNote(note.frequency);
    }, note.time - startTime);
  });
}

function deleteRecording(index) {
  recordings.splice(index, 1);
  renderRecordings();
}

function updateOctaveDisplay() {
  octaveDisplay.textContent = `Octave: ${currentOctave}`;
}

renderPiano();
renderKeybindings();
updateOctaveDisplay();
renderRecordings();
</script>

<div style="position: fixed; bottom: 10px; right: 10px; font-size: 12px; color: #666;">
  <a href="https://websim.ai/piano/about" style="color: #888;">About WebSim Piano</a> | 
  <a href="https://websim.ai/piano/lessons" style="color: #888;">Piano Lessons</a> | 
  <a href="https://websim.ai/piano/composer" style="color: #888;">AI Composer</a> |
  <a href="https://websim.ai/piano/studio" style="color: #888;">Advanced Studio</a>
</div>

</body></html>